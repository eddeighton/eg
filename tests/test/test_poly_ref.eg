

abstract A
{
}

action B[ 4 ] : A
{
    action Counter
    {
        dim int x;
        while( true )
        {
            x( x() + 1 );
            SLEEP;
        }
    }
    while( !Done() )
        SLEEP;
}

action D[ 4 ] : A
{
    action Counter
    {
        dim int x;
        while( true )
        {
            x( x() + 2 );
            SLEEP;
        }
    }
    while( !Done() )
        SLEEP;
}

action C[ 4 ]
{
    dim A a1;
    dim A a2;
    
    while( true )
        SLEEP;
}

C c = C();
{
    c.a1( B() );
    Var< B::Counter, D::Counter > v = c.a1.Counter();
    TEST( v.x() == 0 );
}
{
    c.a2( D() );
    c.a2.Counter();
}

SLEEP;
SLEEP;

TEST_MSG( c.a1.x() == 1, "Counter x should be 1: " << c.a1.x() );
TEST_MSG( c.a2.x() == 2, "Counter x should be 2: " << c.a2.x() );

SLEEP;

TEST_MSG( c.a1.x() == 2, "Counter x should be 2: " << c.a1.x() );
TEST_MSG( c.a2.x() == 4, "Counter x should be 4: " << c.a2.x() );
