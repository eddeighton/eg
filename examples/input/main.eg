
include( <boost/optional.hpp> );

eg::wait(); //wait for initialisation script

bool bContinue = true;
while( bContinue )
{
	cinder::gl::clear();
    
    dim boost::optional< cinder::vec2 > lastPos;
    
    while( boost::optional< cinder::app::InputEvent > eventOpt = Input::getEvent() )
    {
        const cinder::app::InputEvent& e = eventOpt.get();
        switch( e.type )
        {
            case cinder::app::InputEvent::eMouseDown:
                {
                    lastPos( boost::optional< cinder::vec2 >( e.mouseEvent.getPos() ) );
                    if( Circle c = Circle.Start() )
                    {
                        c.Init( lastPos().get() );
                    }
                }
                break;
            case cinder::app::InputEvent::eMouseUp:
                {
                    lastPos( boost::optional< cinder::vec2 >() );
                }
                break;
            case cinder::app::InputEvent::eMouseMove:
                break;
            case cinder::app::InputEvent::eMouseDrag:
                if( lastPos() )
                {
                    const cinder::vec2 mousePos( e.mouseEvent.getPos() );
                    
                    const cinder::vec2 dir = mousePos - lastPos().get();
                    dim float smoothing;
                    const float fSteps = glm::length( dir ) * smoothing();
                    for( float i = 0.0f; i < fSteps; ++i )
                    {
                        if( Circle c = Circle.Start() )
                        {
                            c.Init( lastPos().get() );
                        }
                    }
                    lastPos( boost::optional< cinder::vec2 >( mousePos ) );
                    
                    //try to start a circle
                    if( Circle c = Circle.Start() )
                    {
                        c.Init( lastPos().get() );
                    }
                }
                else
                {
                    LOG( "Mouse Drag: no lastpos"  );
                }
                break;
            case cinder::app::InputEvent::eMouseWheel:
                break;
            case cinder::app::InputEvent::eKeyDown:
                break;
            case cinder::app::InputEvent::eKeyUp:
                break;
        }
    }
    
    eg::sleep();
}